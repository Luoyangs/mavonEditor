import Vue from 'vue';
import ShopeeProgress from '../index';
import { createElement, destroyInstance } from '@/test/utils';

Vue.use(ShopeeProgress);

const createSimpleProgress = (props = {}) => {
  return new Vue({
    template: '<shopee-progress ref="progress" v-bind="props"></shopee-progress>',
    data() {
      return {
        props
      };
    }
  }).$mount(createElement());
};

describe('progress.vue', () => {
  let vm;
  afterEach(() => {
    destroyInstance(vm);
  });

  it('should render correct', () => {
    vm = createSimpleProgress({
      percentage: 66,
    });
    expect(vm.$el.classList.contains('shopee-progress')).to.be.true;
  });

  it('should show percentage correct', () => {
    vm = createSimpleProgress({
      percentage: 66
    });
    const node = vm.$el.querySelector('.bar__inner');
    expect(node.style.width).to.equals('66%');
  });

  it('should render correct size & color & status', () => {
    vm = createSimpleProgress({
      percentage: 66,
      size: 'small',
      color: function() {
        return '#000000';
      },
      status: 'fail'
    });
    const outer = vm.$el.querySelector('.bar__outer');
    const inner = vm.$el.querySelector('.bar__inner');
    const text = vm.$el.querySelector('.shopee-progress-text');
    expect(outer.classList.contains('is-small')).to.be.true;
    expect(getComputedStyle(inner).backgroundColor).to.equals('rgb(0, 0, 0)');
    expect(!!text.querySelector('.icon')).to.be.true;
  });

  it('should render correct content', () => {
    vm = createSimpleProgress({
      percentage: 66,
      format: function(p) {
        return `${p}/100`;
      }
    });
    const desc = vm.$el.querySelector('.desc');
    expect(desc.innerText).to.equals('66/100');
  });

  it('should hide content', () => {
    vm = createSimpleProgress({
      percentage: 66,
      showText: false
    });
    const text = vm.$el.querySelector('.shopee-progress-text');
    expect(!text).to.be.true;
  });
});

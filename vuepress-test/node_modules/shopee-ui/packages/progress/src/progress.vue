<template>
  <div class="shopee-progress"
    :class="className"
    role="progress">
    <div class="shopee-progress-bar">
      <div class="bar__outer" :class="barClassName">
        <div class="bar__inner" :style="barStyle">
        </div>
      </div>
    </div>
    <div
      class="shopee-progress-text"
      v-if="showText"
      >
      <template v-if="$scopedSlots.default">
        <slot :percentage="percentage"></slot>
      </template>
      <template v-else>
        <span class="desc" v-if="status !== 'fail'">{{content}}</span>
        <shopee-icon v-if="status === 'fail'" class="icon" :class="iconClass" :svg="errorSIcon"></shopee-icon>
      </template>
    </div>
  </div>
</template>
<script>
import { Icon as ShopeeIcon } from 'shopee-ui/lib/icon';
import ErrorSIcon from '@shopee-ui/icon/svg/error-s.svg';
export default {
  name: 'ShopeeProgress',
  components: {
    ShopeeIcon
  },
  props: {
    size: {
      type: String,
      default: 'normal',
      validator: val => ['small', 'normal'].indexOf(val) >= 0
    },
    percentage: {
      type: Number,
      default: 0,
      validator: val => val >= 0 && val <= 100
    },
    status: {
      type: String,
      default: 'normal',
      validator: val => ['normal','fail'].indexOf(val) >= 0
    },
    showText: {
      type: Boolean,
      default: true
    },
    color: {
      type: [String, Function],
      default: ''
    },
    format: Function
  },
  data() {
    return {
      errorSIcon: ErrorSIcon
    };
  },
  computed: {
    className() {
      return [
        !this.showText ? 'text-hide' : ''
      ];
    },
    barClassName() {
      return [
        this.status ? 'is-' + this.status : '',
        this.size === 'small' ? 'is-small' : ''
      ];
    },
    barStyle() {
      const style = {};
      style.width = this.percentage + '%';
      style.backgroundColor = this.getCurrentColor(this.percentage);
      return style;
    },
    iconClass() {
      return [
        `icon__${this.status}`
      ];
    },
    content() {
      if (typeof this.format === 'function') {
        return this.format(this.percentage) || '';
      } else {
        return `${this.percentage}%`;
      }
    }
  },

  methods: {
    getCurrentColor(percentage) {
      if (typeof this.color === 'function') {
        return this.color(percentage) || '';
      } else if (typeof this.color === 'string') {
        return this.color;
      } else {
        return '';
      }
    }
  }
};
</script>

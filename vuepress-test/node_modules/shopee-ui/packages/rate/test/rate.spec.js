import Vue from 'vue';
import ShopeeRate from '../index';
import { createInstance, createElement, destroyInstance } from '@/test/utils';
import likeSIcon from '@shopee-ui/icon/svg/like.svg';

Vue.use(ShopeeRate);

describe('rate.vue', () => {
  let vm;
  afterEach(() => {
    destroyInstance(vm);
  });

  it('should render correct', () => {
    vm = createInstance(ShopeeRate);
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
  });

  it('should show correct value', () => {
    vm = createInstance(ShopeeRate, {
      value: 3
    });
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.innerValue).to.equals(3);
    const starElms = Array.prototype.slice.call(vm.$el.querySelectorAll('.shopee-rate-star__front'));
    expect(starElms.filter(n => n.style.width === '100%').length).to.equals(3);
  });

  it('should show correct value when value is decimal', () => {
    vm = createInstance(ShopeeRate, {
      value: 3.8
    });
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.innerValue).to.equals(3);
    const starElms = Array.prototype.slice.call(vm.$el.querySelectorAll('.shopee-rate-star__front'));
    expect(starElms.filter(n => n.style.width === '100%').length).to.equals(3);
  });

  it('should show correct value when allow half and value equal 3.2', () => {
    vm = createInstance(ShopeeRate, {
      allowHalf: true,
      value: 3.2
    });
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.innerValue).to.equals(3);
    const starElms = Array.prototype.slice.call(vm.$el.querySelectorAll('.shopee-rate-star__front'));
    expect(starElms.filter(n => n.style.width === '100%').length).to.equals(3);
    expect(starElms.filter(n => n.style.width === '50%').length).to.equals(0);
  });

  it('should show correct value when allow half and value equal 3.8', () => {
    vm = createInstance(ShopeeRate, {
      allowHalf: true,
      value: 3.8
    });
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.innerValue).to.equals(3.5);
    const starElms = Array.prototype.slice.call(vm.$el.querySelectorAll('.shopee-rate-star__front'));
    expect(starElms.filter(n => n.style.width === '100%').length).to.equals(3);
    expect(starElms.filter(n => n.style.width === '50%').length).to.equals(1);
  });

  it('should show correct value when hover', done => {
    vm = createInstance(ShopeeRate);
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.innerValue).to.equals(0);
    vm.$el.querySelectorAll('.shopee-rate-star')[3].dispatchEvent(new Event('mousemove'));
    setTimeout(() => {
      expect(vm.innerValue).to.equals(4);
      done();
    });
  });

  it('should change value correctly when click', done => {
    vm = new Vue({
      template: '<shopee-rate v-model="value"></shopee-rate>',
      data() {
        return {
          value: 0
        };
      }
    }).$mount(createElement());
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    vm.$el.querySelectorAll('.shopee-rate-star')[3].dispatchEvent(new Event('mousemove'));
    vm.$el.querySelectorAll('.shopee-rate-star')[3].click();
    setTimeout(() => {
      expect(vm.value).to.equals(4);
      done();
    });
  });

  it('count', () => {
    vm = createInstance(ShopeeRate, {
      count: 8
    });
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.$el.querySelectorAll('.shopee-rate-star').length).to.equals(8);
  });

  it('disabled', done => {
    vm = new Vue({
      template: '<shopee-rate v-model="value" disabled></shopee-rate>',
      data() {
        return {
          value: 1
        };
      }
    }).$mount(createElement());
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.$el.classList.contains('shopee-rate-disabled')).to.be.true;
    vm.$el.querySelectorAll('.shopee-rate-star')[3].dispatchEvent(new Event('mousemove'));
    vm.$el.querySelectorAll('.shopee-rate-star')[3].click();
    setTimeout(() => {
      expect(vm.value).to.equals(1);
      done();
    });
  });

  it('allow decimal', () => {
    vm = createInstance(ShopeeRate, {
      disabled: true,
      allowDecimal: true,
      value: 3.8
    });
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.innerValue).to.equals(3.8);
    const starElms = Array.prototype.slice.call(vm.$el.querySelectorAll('.shopee-rate-star__front'));
    expect(starElms.filter(n => n.style.width === '100%').length).to.equals(3);
    expect(starElms.filter(n => n.style.width === '75%').length).to.equals(1);
  });

  it('show text', () => {
    vm = new Vue({
      template: '<shopee-rate v-model="value" show-text></shopee-rate>',
      data() {
        return {
          value: 1
        };
      }
    }).$mount(createElement());
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.$el.querySelector('.shopee-rate-text')).to.be.exist;
  });

  it('icon', () => {
    vm = new Vue({
      template: '<shopee-rate v-model="value" :icon="likeSIcon"></shopee-rate>',
      data() {
        return {
          likeSIcon,
          value: 1
        };
      }
    }).$mount(createElement());
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.$el.querySelector('.shopee-rate-star__front .shopee-icon').innerHTML).to.equals(likeSIcon);
  });

  it('character', () => {
    vm = createInstance(ShopeeRate, {
      character: 'A',
      value: 1
    });
    expect(vm.$el.classList.contains('shopee-rate')).to.be.true;
    expect(vm.$el.querySelector('.shopee-rate-star__front').innerHTML).to.equals('A');
  });
});

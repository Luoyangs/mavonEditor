<template>
  <div :class="className" ref="steps">
    <slot></slot>
  </div>
</template>
<script>
export default {
  name: 'ShopeeSteps',
  props: {
    current: {
      type: Number,
      default: 0
    },
    // horizontal, vertical
    labelPlacement: {
      type: String,
      default: 'horizontal'
    },
    progressDot: {
      type: Boolean,
      default: false
    }
  },
  data() {
    return {
      prefixClass: 'shopee-steps',
      isMaxWidth: false
    };
  },
  computed: {
    virtualLabelPlacement() {
      return this.progressDot ? 'vertical' : this.labelPlacement;
    },
    className() {
      return [
        this.prefixClass,
        this.prefixClass + '-label-' + this.virtualLabelPlacement,
        this.progressDot && (this.prefixClass + '-dot'),
        this.isMaxWidth && (this.prefixClass + '-max-width')
      ];
    }
  },
  watch: {
    current() {
      this.updateChild();
    }
  },
  mounted() {
    this.updateChild();
    this.updateStyle();
  },
  methods: {
    updateChild() {
      this.$children.forEach((child, index) => {
        child.index = index;
        child.current = this.current;
        child.isDot = this.progressDot;
      });
    },
    updateStyle() {
      const maxWidth = this.progressDot ? 160 : 120;
      this.isMaxWidth = this.$children[0].$refs.tail.clientWidth > maxWidth;
    }
  }
};
</script>

<template>
  <div :class="className">
    <div :class="prefixClass + '__head'">
      <shopee-icon v-if="icon" :svg="icon" :class="prefixClass + '__head-icon'"></shopee-icon>
      <span v-else-if="isDot" :class="prefixClass + '__head-dot'"></span>
      <span v-else :class="prefixClass + '__head-step'">{{index + 1}}</span>
    </div>
    <div :class="[prefixClass + '__content', titleOverflow ? '' : prefixClass + '__content-single' ]">
      <shopee-tooltip :content="title" :value="titleOverflow && hover === 'title'">
        <div :class="prefixClass + '-title'" @mouseover="hover='title'" @mouseleave="hover=''"><span ref="title">{{title}}</span></div>
      </shopee-tooltip>
      <shopee-tooltip :content="desc" :value="descOverflow && hover === 'desc'">
        <div :class="prefixClass + '-desc'" @mouseover="hover='desc'" @mouseleave="hover=''"><span ref="desc">{{desc}}</span></div>
      </shopee-tooltip>
    </div>
    <div ref="tail" :class="prefixClass + '__tail'"></div>
  </div>
</template>
<script>
import { Icon as ShopeeIcon } from 'shopee-ui/lib/icon';
import { Tooltip as ShopeeTooltip } from 'shopee-ui/lib/tooltip';

export default {
  name: 'ShopeeStep',
  components: {
    ShopeeIcon,
    ShopeeTooltip
  },
  props: {
    icon: String,
    title: String,
    desc: String
  },
  data() {
    return {
      prefixClass: 'shopee-step',
      index: 0,
      current: 0,
      isDot: false,
      hover: '',
      descOverflow: false,
      titleOverflow: false,
    };
  },
  computed: {
    className() {
      return {
        [this.prefixClass]: true,
        'disabled': this.index > this.current,
        'finished': this.index < this.current,
        'active': this.index === this.current,
        [this.prefixClass + '-dot']: this.isDot && !this.icon
      };
    }
  },
  mounted() {
    this.titleOverflow = this.isOverflow(this.$refs.title, 2);
    this.descOverflow = this.isOverflow(this.$refs.desc, 2);
  },
  methods: {
    isOverflow(ele, lineNum) {
      let flag = false;
      if (ele) {
        const rectList = ele.getClientRects();
        if (rectList.length > lineNum) {
          flag = true;
        }
      }
      return flag;
    }
  }
};
</script>

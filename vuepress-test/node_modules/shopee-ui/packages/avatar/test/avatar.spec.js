import Vue from 'vue';
import ShopeeAvatar from '../index';
import productIcon from '@/static/svg/product-img.svg';
import { createInstance, destroyInstance, createElement } from '@/test/utils';

Vue.use(ShopeeAvatar);

describe('avatar.vue', () => {
  let vm;
  afterEach(() => {
    destroyInstance(vm);
  });

  it('should validate correctly', () => {
    vm = createInstance(ShopeeAvatar);

    expect(vm.$el.classList.contains('shopee-avatar')).to.be.true;
    expect(vm.$el.querySelector('.shopee-icon')).to.be.exist;
  });

  it('should render correct size', () => {
    vm = createInstance(ShopeeAvatar, {
      size: 'large'
    });
    expect(vm.$el.classList.contains('shopee-avatar--large')).to.be.true;
  });

  it('src', () => {
    vm = createInstance(ShopeeAvatar, {
      src: 'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg'
    });

    expect(vm.$el.querySelector('.shopee-avatar-img')).to.be.exist;
  });

  it('icon', () => {
    vm = createInstance(ShopeeAvatar, {
      icon: productIcon
    });

    expect(vm.$el.querySelector('.shopee-icon')).to.be.exist;
    expect(vm.$el.classList.contains('shopee-avatar--icon')).to.be.true;
  });

  it('circle', () => {
    vm = createInstance(ShopeeAvatar, {
      circle: true
    });

    expect(vm.$el.querySelector('.shopee-icon')).to.be.exist;
    expect(vm.$el.classList.contains('shopee-avatar--circle')).to.be.true;
  });

  it('render default slot', () => {
    vm = new Vue({
      template: `
      <shopee-avatar>
        <img src="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg"/>
      </shopee-avatar>`,
    }).$mount(createElement());

    expect(vm.$el.querySelector('img')).to.be.exist;
  });

  it('emit error', done => {
    vm = new Vue({
      template: '<shopee-avatar ref="avatar" src="errorLink" :error="errorHandler"/></shopee-avatar>',
      data() {
        return {
          errorHandler() {
            return true;
          }
        };
      }
    }).$mount(createElement());

    setTimeout(() => {
      // expect(vm.$el.querySelector('.shopee-avatar-img')).to.be.null;
      expect(vm.$refs.avatar.isImageExist).to.be.false;
      expect(vm.$el.querySelector('.shopee-icon')).to.be.exist;
      done();
    }, 100);
  });
});

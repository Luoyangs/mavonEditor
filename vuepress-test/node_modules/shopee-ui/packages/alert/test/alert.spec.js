import Vue from 'vue';
import ShopeeAlert from '../index';
import { createElement, destroyInstance } from '@/test/utils';
import successIcon from '@shopee-ui/icon/svg/success-s.svg';

Vue.use(ShopeeAlert);

const createAlert = props => {
  return new Vue({
    template: '<shopee-alert ref="alert" v-bind="props">alert text</shopee-alert>',
    data() {
      return {
        props
      };
    }
  }).$mount(createElement());
};

describe('alert.vue', () => {
  let vm;
  afterEach(() => {
    destroyInstance(vm);
  });

  it('should render correct', () => {
    vm = createAlert();
    expect(vm.$el.classList.contains('shopee-alert')).to.be.true;
    expect(vm.$el.querySelector('.shopee-alert-title')).to.exist;
    expect(vm.$el.querySelector('.shopee-alert-title').innerHTML).to.equals('alert text');
  });

  it('should render description', () => {
    vm = createAlert({
      description: 'alert description'
    });
    expect(vm.$el.querySelector('.shopee-alert-desc')).to.exist;
    expect(vm.$el.querySelector('.shopee-alert-desc').innerHTML).to.equals('alert description');
  });

  it('should render with type', () => {
    vm = createAlert({
      type: 'success'
    });
    expect(vm.$el.classList.contains('shopee-alert--success')).to.be.true;
  });

  it('closable', () => {
    vm = createAlert({
      closable: true
    });
    expect(vm.$el.querySelector('.shopee-alert-close')).to.exist;
    vm.$el.querySelector('.shopee-alert-close').click();
    expect(vm.$refs.alert.visible).to.be.false;
  });

  it('custom close text', () => {
    vm = createAlert({
      closable: true,
      closeText: 'close'
    });
    expect(vm.$el.querySelector('.shopee-alert-close')).to.exist;
    expect(vm.$el.querySelector('.shopee-alert-close span').innerHTML).to.equals('close');
    vm.$el.querySelector('.shopee-alert-close').click();
    expect(vm.$refs.alert.visible).to.be.false;
  });

  it('show icon: false', () => {
    vm = createAlert({
      type: 'success',
      showIcon: false
    });
    expect(vm.$el.querySelector('.shopee-alert-icon')).to.not.exist;
  });

  it('center', () => {
    vm = createAlert({
      center: true
    });
    expect(vm.$el.classList.contains('is-center')).to.be.true;
  });

  it('icon change', (done) => {
    vm = createAlert({
      type: 'error'
    });
    vm.$set(vm.props,'type','success');
    setTimeout(() => {
      expect(vm.$el.classList.contains('shopee-alert--success')).to.be.true;
      done();
    });
  });

  it('should compute icon correct', () => {
    vm = createAlert({
      type: 'success'
    });
    let alert = vm.$refs.alert;
    expect(alert.icon === successIcon).to.be.true;
  });
});


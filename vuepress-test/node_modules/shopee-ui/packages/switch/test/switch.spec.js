import Vue from 'vue';
import ShopeeSwitch from '../index';
import { createInstance, destroyInstance, createElement } from '@/test/utils';

Vue.use(ShopeeSwitch);

describe('switch.vue', () => {
  let vm;
  afterEach(() => {
    destroyInstance(vm);
  });

  it('should render:normal', () => {
    vm = createInstance(ShopeeSwitch);
    expect(vm.$el.classList.contains('shopee-switch')).to.be.true;
    expect(vm.$el.classList.contains('shopee-switch--normal')).to.be.true;
    expect(vm.$el.classList.contains('shopee-switch--close')).to.be.true;
    expect(vm.$el.classList.length).to.equal(3);
  });

  it('should render:small', () => {
    vm = createInstance(ShopeeSwitch, {
      size: 'small'
    }, true);
    const classes = [].slice.call(vm.$el.classList);
    expect(classes).to.include('shopee-switch--small');
    expect(classes.length).to.equal(3);
  });
  it('should render:loading', () => {
    vm = createInstance(ShopeeSwitch, {
      loading: true,
      value: true
    }, true);
    const classes = [].slice.call(vm.$el.classList);
    expect(classes).to.include('shopee-switch--loading');
    expect(classes.length).to.equal(4);
  });

  it('should render:change', (done) => {
    vm = new Vue({
      template: '<shopee-switch ref="test" @change="onChange" :value="switchValue" />',
      data: {
        switchValue: false
      },
      methods: {
        onChange(val) {
          expect(val).to.equal(true);
          done();
        }
      }
    });
    vm.$mount(createElement());
    vm.$refs.test.$el.click();
  });

  it('should render:disable', (done) => {
    vm = new Vue({
      template: '<shopee-switch ref="test" @change="onChange" :disabled="true" :value="false" />',
      methods: {
        onChange,
      }
    });
    let hasChanged = false;
    function onChange() {
      hasChanged = true;
    }
    vm.$mount(createElement());
    vm.$refs.test.$el.click();
    setTimeout(function() {
      expect(hasChanged).to.equal(false);
      done();
    });
  });

  it('should render:v-model', (done) => {
    const originValue = false;
    vm = new Vue({
      template: '<shopee-switch ref="test" v-model="switchValue" />',
      data: {
        switchValue: originValue
      },
    });
    vm.$mount(createElement());
    vm.$refs.test.$el.click();
    setTimeout(function() {
      expect(vm.$data.switchValue).to.be.true;
      done();
    });
  });

  it('should render:label', (done) => {
    vm = new Vue({
      template: '<shopee-switch ref="test" active-text="on" inactive-text="off" v-model="switchValue" />',
      data: {
        switchValue: true
      }
    });
    vm.$mount(createElement());
    setTimeout(() => {
      expect(vm.$refs.test.$el.querySelector('.shopee-switch__label').innerHTML).to.equals('on');
      vm.$refs.test.$el.click();
      setTimeout(() => {
        expect(vm.$refs.test.$el.querySelector('.shopee-switch__label--inactive').innerHTML).to.equals('off');
        done();
      });
    });
  });
});

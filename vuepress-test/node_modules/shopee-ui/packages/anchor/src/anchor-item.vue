<template>
  <div :class="anchorItemClass">
    <a class="shopee-anchor__item__title" :href="href" :data-href="href" @click.prevent="goAnchor" :title="title">
      {{ title }}<!--
      --><shopee-icon v-if="errorIcon" class="error-icon" :svg="errorIcon"></shopee-icon>
    </a>
    <slot></slot>
  </div>
</template>
<script>
import { Icon as ShopeeIcon } from 'shopee-ui/lib/icon';

export default {
  name: 'ShopeeAnchorItem',
  components: {
    ShopeeIcon
  },
  props: {
    href: String,
    title: String,
    errorIcon: String
  },
  computed: {
    anchorItemClass() {
      return {
        'shopee-anchor__item': true,
        'shopee-anchor__item--active': this.anchor.currentLink === this.href
      };
    },
    anchor() {
      let parent = this.$parent;
      while (parent && parent.$options.name !== 'ShopeeAnchor') {
        parent = parent.$parent;
      }

      return parent;
    },
    name() {
      return 'ShopeeAnchorItem';
    }
  },
  mounted() {
    this.$nextTick(() => {
      this.anchor.init();
    });
  },
  methods: {
    goAnchor() {
      this.currentLink = this.href;
      this.anchor.handleHashChange();
      this.anchor.handleScrollTo();
      this.anchor.$emit('select', this.href);
      const isRoute = this.$router;
      if (isRoute) {
        this.$router.push(this.href, () => {});
      } else {
        window.location.href = this.href;
      }
    }
  }
};
</script>

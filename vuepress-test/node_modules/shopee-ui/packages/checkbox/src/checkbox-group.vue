<template>
    <div class="shopee-checkbox-group" :class="[
            sizeClass ? 'shopee-checkbox-group--' + sizeClass : '',
            {
                'vertical': layout === 'vertical'
            }
        ]">
        <slot></slot>
    </div>
</template>

<script>
import { EventBusMixin, FormItemMixin } from 'shopee-ui/lib/base';

const diffArray = (arr1, arr2) => {
  return arr1.concat(arr2).filter(e => arr1.indexOf(e) === -1 || arr2.indexOf(e) === -1);
};

export default {
  name: 'ShopeeCheckboxGroup',
  mixins: [EventBusMixin, FormItemMixin],
  props: {
    value: {
      default() {
        return [];
      }
    },
    // vertical or horizontal
    layout: {
      type: String,
      default: 'horizontal'
    },
    // x-large, large, normal, small
    size: {
      type: String,
      validator(value = 'normal') {
        return ['x-large', 'large', 'normal', 'small'].indexOf(value) >= 0;
      }
    },
    disabled: Boolean,
    fixWidth: [Boolean, Number]
  },
  created() {
    // listen to change event of checkbox
    // and update value
    this.$on('checkbox-change', checkbox => {
      let newValue = [];
      if (checkbox.checked) {
        if (this.value.indexOf(checkbox.value) === -1) {
          newValue = this.value.concat([checkbox.value]);
        }
      } else {
        this.value.forEach(item => {
          if (item !== checkbox.value) {
            newValue.push(item);
          }
        });
      }
      this.$emit('input', newValue);
      // emit change when newValue and this.value are not same length or have different items
      if (newValue.length !== this.value.length || diffArray(newValue, this.value).length > 0) {
        this.$emit('change', newValue);
        this.dispatch('ShopeeFormItem', 'field-change', newValue);
      }
    });
  }
};
</script>

import Vue from 'vue';
import ShopeeCheckbox from '../index';
import { destroyInstance, createElement } from '@/test/utils';

Vue.use(ShopeeCheckbox);

describe('checkbox-group.vue', () => {
  let vm;
  afterEach(() => {
    destroyInstance(vm);
  });

  it('should render correct', () => {
    vm = new Vue({
      template: `
        <shopee-checkbox-group>
          <shopee-checkbox>Label1</shopee-checkbox>
          <shopee-checkbox>Label2</shopee-checkbox>
          <shopee-checkbox>Label3</shopee-checkbox>
        </shopee-checkbox-group>
      `
    }).$mount(createElement());
    expect(vm.$el.classList.contains('shopee-checkbox-group')).to.be.true;
  });

  it('should render correct size', () => {
    vm = new Vue({
      template: `
        <shopee-checkbox-group size="large">
          <shopee-checkbox>Label1</shopee-checkbox>
          <shopee-checkbox>Label2</shopee-checkbox>
          <shopee-checkbox>Label3</shopee-checkbox>
        </shopee-checkbox-group>
      `
    }).$mount(createElement());
    expect(vm.$el.classList.contains('shopee-checkbox-group--large')).to.be.true;
  });

  it('should render correct layout', () => {
    vm = new Vue({
      template: `
        <shopee-checkbox-group layout="vertical">
          <shopee-checkbox>Label1</shopee-checkbox>
          <shopee-checkbox>Label2</shopee-checkbox>
          <shopee-checkbox>Label3</shopee-checkbox>
        </shopee-checkbox-group>
      `
    }).$mount(createElement());
    expect(vm.$el.classList.contains('vertical')).to.be.true;
  });

  it('should render correct when disabled', () => {
    vm = new Vue({
      template: `
        <shopee-checkbox-group disabled>
          <shopee-checkbox>Label1</shopee-checkbox>
          <shopee-checkbox>Label2</shopee-checkbox>
          <shopee-checkbox>Label3</shopee-checkbox>
        </shopee-checkbox-group>
      `
    }).$mount(createElement());
    let checkboxElems = vm.$el.querySelectorAll('.shopee-checkbox');
    let disabed = true;
    for (let i = 0; i < checkboxElems.length; i++) {
      disabed = disabed && checkboxElems[i].classList.contains('disabled');
    }
    expect(disabed).to.be.true;
  });

  it('should check correct checkbox in checkbox-group', done => {
    vm = new Vue({
      template: `
        <shopee-checkbox-group v-model="checkList">
          <shopee-checkbox ref="a" value=1>Label1</shopee-checkbox>
          <shopee-checkbox ref="b" value=2>Label2</shopee-checkbox>
          <shopee-checkbox ref="c" value=3>Label3</shopee-checkbox>
        </shopee-checkbox-group>
      `,
      data() {
        return {
          checkList: ['1']
        };
      }
    }).$mount(createElement());
    expect(vm.$refs.a.model).to.be.true;
    expect(vm.$refs.b.model).to.be.false;
    expect(vm.$refs.c.model).to.be.false;
    setTimeout(() => {
      vm.$refs.b.$el.click();
      setTimeout(() => {
        expect(vm.$refs.a.model).to.be.true;
        expect(vm.$refs.b.model).to.be.true;
        expect(vm.$refs.c.model).to.be.false;
        done();
      });
    });
  });

  it('should check correct checkbox in checkbox-group when some checkbox clicked', done => {
    vm = new Vue({
      template: `
        <shopee-checkbox-group v-model="checkList">
          <shopee-checkbox-button ref="a" value=1>Label1</shopee-checkbox-button>
          <shopee-checkbox-button ref="b" value=2>Label2</shopee-checkbox-button>
          <shopee-checkbox-button ref="c" value=3>Label3</shopee-checkbox-button>
        </shopee-checkbox-group>
      `,
      data() {
        return {
          checkList: ['1', '2', '3']
        };
      }
    }).$mount(createElement());
    expect(vm.$refs.a.model).to.be.true;
    expect(vm.$refs.b.model).to.be.true;
    expect(vm.$refs.c.model).to.be.true;
    setTimeout(() => {
      vm.$refs.a.$el.click();
      setTimeout(() => {
        expect(vm.$refs.a.model).to.be.false;
        expect(vm.$refs.b.model).to.be.true;
        expect(vm.$refs.c.model).to.be.true;
        done();
      });
    });
  });

  it('should check correct checkbox in checkbox-group when some checkbox rendered with v-for', done => {
    vm = new Vue({
      template: `
        <shopee-checkbox-group v-model="checkList">
          <shopee-checkbox-button ref="a" value=1>Label1</shopee-checkbox-button>
          <template v-for="checkbox in checkboxs">
            <shopee-checkbox-button ref="b" :value="checkbox.value">{{checkbox.label}}</shopee-checkbox-button>
          </template>
        </shopee-checkbox-group>
      `,
      data() {
        return {
          checkList: ['1', '2', '3'],
          checkboxs: [{
            value: '2',
            label: 'Label2'
          }, {
            value: '3',
            label: 'Label3'
          }]
        };
      }
    }).$mount(createElement());
    expect(vm.$refs.a.model).to.be.true;
    expect(vm.$refs.b[0].model).to.be.true;
    expect(vm.$refs.b[1].model).to.be.true;
    setTimeout(() => {
      vm.$refs.b[1].$el.click();
      setTimeout(() => {
        expect(vm.$refs.a.model).to.be.true;
        expect(vm.$refs.b[0].model).to.be.true;
        expect(vm.$refs.b[1].model).to.be.false;
        vm.checkboxs.shift();
        setTimeout(() => {
          expect(vm.$refs.a.model).to.be.true;
          expect(vm.$refs.b[0].model).to.be.false;
          expect(vm.checkList.join('')).to.equals('12');
          done();
        });
      });
    });
  });

  it('should render correct when fixWidth', done => {
    vm = new Vue({
      template: `
        <shopee-checkbox-group :fix-width="120">
          <shopee-checkbox>Label1</shopee-checkbox>
          <shopee-checkbox>Label2</shopee-checkbox>
          <shopee-checkbox>Label3</shopee-checkbox>
        </shopee-checkbox-group>
      `
    }).$mount(createElement());

    setTimeout(() => {
      const checkboxElems = vm.$el.querySelectorAll('.shopee-checkbox__label');
      const fixWidth = parseInt(checkboxElems[0].style.width) === 120;
      expect(fixWidth).to.be.true;
      done();
    });
  });
});

<template>
  <div class="shopee-toasts">
    <toast
      v-for="toast in toasts"
      :key="toast.id"
      :sid="toast.id"
      :class-names="toast.classNames"
      :type="toast.type"
      :message="toast.message"
      :duration="toast.duration"
      :max-width="toast.maxWidth"
      :min-width="toast.minWidth"
      :keep-on-hover="toast.keepOnHover"
    ></toast>
  </div>
</template>

<script>
import Toast from './toast.vue';

export default {
  name: 'ShopeeToasts',
  components: {
    Toast
  },
  props: {
    max: Number
  },
  data() {
    return {
      toasts: [],
      toastInstances: []
    };
  },
  beforeUpdate() {
    // close the invisible toasts
    this.toastInstances.forEach(vm => {
      if (!vm.visible) {
        vm.close();
      }
    });
  },
  methods: {
    add(options) {
      this.toasts.push(options);
      // close the first toast when count is greater than max
      if (this.max && this.toasts.length > this.max) {
        const firstVisibleToast = this.toastInstances.find(n => !!n.visible);
        firstVisibleToast && firstVisibleToast.close();
      }
    },
    remove(id) {
      const toastIndex = this.toasts.findIndex(n => n.id === id);
      const toastInstanceIndex = this.toastInstances.findIndex(n => n.sid === id);
      toastIndex > -1 && this.toasts.splice(toastIndex, 1);
      toastInstanceIndex > -1 && this.toastInstances.splice(toastInstanceIndex, 1);
    },
    addInstance(vm) {
      this.toastInstances.push(vm);
      // set visible true
      const toast = this.toasts.find(n => n.id === vm.sid);
      if (toast.visible) {
        vm.visible = true;
      }
    },
    closeToast(id) {
      const toastInstance = this.toastInstances.find(n => n.sid === id);
      toastInstance && toastInstance.close();
    }
  }
};
</script>

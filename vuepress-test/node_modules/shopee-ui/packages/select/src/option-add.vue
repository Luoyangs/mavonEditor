<template>
  <div :class="prefixClass">
    <div v-if="!inputStatus" :class="prefixClass + '__text'" @click.stop="toggleInputStatus()">
      <shopee-icon class="add-icon" :svg="addIcon"></shopee-icon>
      <span class="label">{{this.addItemText || t('shopee-ui.select.add-new-item')}}</span>
    </div>
    <div v-else :class="prefixClass + '__input'">
      <shopee-input
        class="input"
        ref="inpugRef"
        size="small"
        v-model="addItemValue">
      </shopee-input>
      <shopee-button class="icon" :icon="confirmIcon" @click="onConfirmClick()"></shopee-button>
      <shopee-button class="icon" :icon="closeIcon" @click="onCancelClick()"></shopee-button>
    </div>
  </div>
</template>
<script>
import { Input as ShopeeInput } from 'shopee-ui/lib/input';
import { Icon as ShopeeIcon } from 'shopee-ui/lib/icon';
import { Button as ShopeeButton } from 'shopee-ui/lib/button';
import CONFIRM_ICON from '@/static/svg/confirm.svg';
import CLOSE_ICON from '@/static/svg/cancel.svg';
import ADD_ICON from '@shopee-ui/icon/svg/add.svg';
import { EventBusMixin, LocaleMixin } from 'shopee-ui/lib/base';

export default {
  name: 'ShopeeOptionAdd',
  componentName: 'ShopeeOptionAdd',
  components: {
    ShopeeInput,
    ShopeeIcon,
    ShopeeButton
  },
  mixins: [EventBusMixin, LocaleMixin],
  props: {
    addItemText: String
  },
  data() {
    return {
      prefixClass: 'shopee-option-add',
      inputStatus: false,
      confirmIcon: CONFIRM_ICON,
      closeIcon: CLOSE_ICON,
      addIcon: ADD_ICON,
      addItemValue: ''
    };
  },
  created() {
    this.$on('visible-change', visible => {
      //面板关闭时重置状态
      if (!visible) {
        this.clearInputValue();
        this.inputStatus = false;
      }
    });
  },

  methods: {
    toggleInputStatus() {
      this.inputStatus = !this.inputStatus;
    },
    clearInputValue() {
      this.addItemValue = '';
    },
    onConfirmClick() {
      this.$emit('add-item', this.addItemValue);
      this.toggleInputStatus();
      this.clearInputValue();
    },
    onCancelClick() {
      this.toggleInputStatus();
      this.clearInputValue();
    }
  }
};
</script>

import Vue from 'vue';
import ModalInstance from './modal';
import { merge } from 'shopee-ui/lib/base';
import { t, currentLang } from 'shopee-ui/lib/locale';

let modalInstance = null;

const modal = function(config) {
  if (!modalInstance) {
    modalInstance = new ModalInstance();
  }
  const i18n = this.$i18n || Vue.prototype._i18n;
  const store = this.$store || Vue.prototype._store;
  const router = this.$router || Vue.prototype._router;
  return modalInstance.open(Vue.extend({
    i18n,
    store,
    router
  }), config);
};

modal.alarm = function(config) {
  const open = modal.bind(this);
  return open(merge({
    type: 'alarm',
    title: t(currentLang, 'shopee-ui.modal.alarm'),
    showCancel: false,
  }, config));
};

modal.confirm = function(config) {
  const open = modal.bind(this);
  return open(merge({
    type: 'confirm',
    title: t(currentLang, 'shopee-ui.modal.confirm'),
    showCancel: true
  }, config));
};

modal.remove = (options) => {
  if (modalInstance) {
    modalInstance.destroyAll(options);
  }
};

export default modal;

<template>
  <div :class="[prefixClass, 'shopee-pagination__part']">
    <shopee-dropdown @visible-change="visibleChange" :show-timeout="0" :hide-timeout="0">
      <span :class="[prefixClass + '__content', active ? 'active' : '']">{{label}}<shopee-icon :svg="activeIcon"></shopee-icon></span>
      <shopee-dropdown-menu :popper-class="prefixClass + '__popper'" slot="dropdown" full-width @click="onPageSizeChange">
        <shopee-dropdown-item :name="size" v-for="(size, index) in pageSizes" :key="index">
          <span>{{size}}</span>
          <shopee-icon :svg="checkedIcon" v-if="pageSize === size"></shopee-icon>
        </shopee-dropdown-item>
      </shopee-dropdown-menu>
    </shopee-dropdown>
  </div>
</template>
<script>
import { Icon as ShopeeIcon } from 'shopee-ui/lib/icon';
import { Dropdown as ShopeeDropdown, DropdownMenu as ShopeeDropdownMenu, DropdownItem as ShopeeDropdownItem } from 'shopee-ui/lib/dropdown';
import { LocaleMixin } from 'shopee-ui/lib/base';
import checkedIcon from '@shopee-ui/icon/svg/checkbox-checked.svg';
import DOWN_ICON from '@shopee-ui/icon/svg/arrow-down.svg';

export default {
  name: 'ShopeePaginationSizes',
  components: {
    ShopeeDropdown,
    ShopeeDropdownMenu,
    ShopeeDropdownItem,
    ShopeeIcon
  },
  mixins: [LocaleMixin],
  props: {
    pageSizes: Array,
    pageSize: Number,
    sizesWithTotal: Boolean,
    total: Number,
    current: Number
  },
  data() {
    return {
      prefixClass: 'shopee-pagination-sizes',
      active: false,
      checkedIcon,
      activeIcon: DOWN_ICON
    };
  },
  computed: {
    label() {
      if (this.sizesWithTotal) {
        let start = (this.current - 1) * this.pageSize + 1;
        let end = start + this.pageSize - 1;
        return this.t('shopee-ui.pagination.page-size-label-with-total', {
          start,
          end,
          total: this.total
        });
      } else {
        return this.t('shopee-ui.pagination.page-size-label', {
          size: this.pageSize
        });
      }
    }
  },
  methods: {
    onPageSizeChange(size) {
      if (size !== this.pageSize) {
        this.$emit('change', +size);
      }
    },
    visibleChange(visible) {
      this.active = visible;
    }
  }
};
</script>

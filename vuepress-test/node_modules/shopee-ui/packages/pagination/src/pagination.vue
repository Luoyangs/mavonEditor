<template>
    <div :class="[prefixClass]">
      <component :is="com.component"
        v-bind="com.props"
        v-on="com.listeners"
        v-for="(com, index) in layoutComponent"
        :key="index"></component>
    </div>
</template>
<script>
import ShopeePages from './components/pages.vue';
import ShopeePaginationSizes from './components/sizes.vue';
import ShopeePaginationJumper from './components/jumper.vue';

export default {
  name: 'ShopeePagination',
  components: {
    ShopeePages,
    ShopeePaginationSizes,
    ShopeePaginationJumper
  },
  props: {
    type: {
      type: String,
      default: 'default',
      validator(value = 'default') {
        return ['default', 'simple', 'increase'].indexOf(value) >= 0;
      }
    },
    current: {
      type: Number,
      default: 1
    },
    pageSize: {
      type: Number,
      default: 10
    },
    pagerCount: Number,
    pageSizes: Array,
    hasMore: Boolean,
    total: Number,
    pageCount: Number,
    // pages, jumper, sizes
    layout: {
      type: String,
      default: 'pages'
    },
    sizesWithTotal: Boolean
  },
  data() {
    return {
      prefixClass: 'shopee-pagination',
      innerPageSize: this.pageSize
    };
  },
  computed: {
    layoutComponent() {
      let layouts = this.layout.split(',');
      if (this.type === 'increase') {
        return [
          {
            component: ShopeePages,
            props: {
              type: this.type,
              current: this.current,
              pageSize: this.innerPageSize,
              total: this.total,
              pageCount: this.pageCount,
              pagerCount: this.pagerCount,
              hasMore: this.hasMore
            },
            listeners: {
              change: this.onPageChange
            }
          }
        ];
      } else {
        return layouts.map(layout => {
          switch (layout) {
            case 'pages':
              return {
                component: ShopeePages,
                props: {
                  type: this.type,
                  current: this.current,
                  pageSize: this.innerPageSize,
                  total: this.total,
                  pageCount: this.pageCount,
                  pagerCount: this.pagerCount
                },
                listeners: {
                  change: this.onPageChange
                }
              };
            case 'jumper':
              return {
                component: ShopeePaginationJumper,
                props: {
                  current: this.current,
                  pageSize: this.innerPageSize,
                  total: this.total,
                  pageCount: this.pageCount
                },
                listeners: {
                  change: this.onPageChange
                }
              };
            case 'sizes':
              return {
                component: ShopeePaginationSizes,
                props: {
                  sizesWithTotal: this.sizesWithTotal,
                  pageSize: this.innerPageSize,
                  pageSizes: this.pageSizes,
                  total: this.total,
                  current: this.current
                },
                listeners: {
                  change: this.onPageSizeChange
                }
              };
          }
        });
      }
    }
  },
  watch: {
    pageSize(val) {
      this.innerPageSize = val;
    }
  },
  methods: {
    onPageChange(page) {
      this.$emit('page-change', page);
    },
    onPageSizeChange(pageSize) {
      this.innerPageSize = pageSize;
      this.$emit('page-size-change', pageSize);
    }
  }
};
</script>

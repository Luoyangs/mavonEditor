<template>
  <div class="shopee-tabs-tabpane" v-if="!lazy || active" v-show="active"><slot></slot></div>
</template>
<script>
export default {
  name: 'ShopeeTabPane',
  props: {
    name: String,
    label: String,
    disabled: Boolean,
    closable: {
      type: Boolean,
      default: undefined
    },
    lazy: Boolean,
    labelMaxWidth: Number
  },
  data() {
    return {
      labelSlot: this.$slots.label
    };
  },
  computed: {
    index() {
      return this.$parent.tabList.findIndex(item => item === this);
    },
    tabKey() {
      return this.name || this.index;
    },
    active() {
      return this.$parent.activeTab === this.tabKey;
    },
    showClose() {
      return this.$parent.type === 'card' && (this.closable === undefined ? this.$parent.closable : this.closable);
    },
    tabInstance() {
      let parent = this.$parent;
      while (parent && 'ShopeeTabs' !== parent.$options.name) {
        parent = parent.$parent;
      }
      return parent;
    }
  },
  updated() {
    // force update labelSlot to restart render of label slot
    // cause change of in slots can not trigger change of labelSlot
    this.$set(this.$data, 'labelSlot', this.$slots.label);
    // force update label auto
    if (this.tabInstance.forceUpdateLabel) {
      this.tabInstance.updateInkBarStyle();
    }
  },
  destroyed() {
    if (this.$el && this.$el.parentNode) {
      this.$el.parentNode.removeChild(this.$el);
    }
  }
};
</script>

import Vue from 'vue';
import ShopeeTimeLine from '../index';
import orderIcon from '@shopee-ui/icon/svg/order.svg';
import { createElement, destroyInstance } from '@/test/utils';

Vue.use(ShopeeTimeLine);

const createTimeline = (props = {}) => {
  props = Object.assign({
    time: '2017/12/12'
  }, props);
  return new Vue({
    template: `
      <shopee-timeline>
        <shopee-timeline-item time="2018-07-05" title="2018年7月5日">
          2018年益普索（Ipsos）的百大影响力品牌研究报告，虾皮购物在数字品牌部分第7名与整体排名第13名。
        </shopee-timeline-item>
        <shopee-timeline-item v-bind="props">
          虾皮购物推出“虾皮24h”购物中心，宣告进军B2C市场，提供24小时快速到货。
        </shopee-timeline-item>
        <shopee-timeline-item time="2017-08-24" title="2017年8月24日">
          虾皮拍卖正式升级为虾皮购物。
        </shopee-timeline-item>
      </shopee-timeline>`,
    data() {
      return {
        props
      };
    }
  }).$mount(createElement());
};

describe('timeline.vue', () => {
  let vm;
  afterEach(() => {
    destroyInstance(vm);
  });

  describe('timeline item', () => {
    it('should render correctly', () => {
      vm = createTimeline();
      expect(vm.$el.classList.contains('shopee-timeline')).to.be.true;
      expect(vm.$el.querySelectorAll('.shopee-timeline-item').length).to.equals(3);
    });

    it('error render', () => {
      vm = createTimeline({
        error: true
      });
      expect(vm.$el.querySelectorAll('.shopee-timeline-item--error').length).to.equals(1);
    });

    it('icon render', () => {
      vm = createTimeline({
        icon: orderIcon
      });
      expect(vm.$el.querySelectorAll('.shopee-timeline-item__dot.icon').length).to.equals(1);
    });

    it('more render', done => {
      vm = new Vue({
        template: `
        <shopee-timeline>
          <shopee-timeline-item time="2018-07-05" title="2018年7月5日" :maxWidth="20">
            2018年益普索（Ipsos）的百大影响力品牌研究报告，虾皮购物在数字品牌部分第7名与整体排名第13名2018年益普索（Ipsos）的百大影响力品牌研究报告，虾皮购物在数字品牌部分第7名与整体排名第13名。
          </shopee-timeline-item>
        </shopee-timeline>`
      }).$mount(createElement());
      expect(vm.$el.querySelectorAll('.shopee-timeline-item__more').length).to.equals(0);
      setTimeout(() => {
        expect(vm.$el.querySelectorAll('.shopee-timeline-item__more').length).to.equals(1);
        done();
      });
    });
  });
});

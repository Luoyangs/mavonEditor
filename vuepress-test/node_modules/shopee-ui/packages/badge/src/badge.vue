<template>
  <div :class="selfClass">
    <slot></slot>
    <transition name="zoom-fast">
      <sup
        v-show="!hidden && (sup || sup === 0 || sup === '')"
        :class="supClass"
        :style="supStyle"><!--
        --><template v-if="sup && !['new', 'hot', 'beta'].includes(type)">{{sup}}</template><!--
        --><span v-else>{{sup}}</span><!--
      --></sup>
    </transition>
  </div>
</template>
<script>
const prefixClass = 'shopee-badge-x';

export default {
  name: 'ShopeeBadge',
  props: {
    type: {
      type: String,
      default: 'dot',
      validator: (val) => {
        return ['dot', 'pulse', 'new', 'hot', 'beta'].includes(val);
      }
    },
    value: [String, Number],
    max: Number,
    hidden: Boolean
  },
  computed: {
    hasValue() {
      return typeof this.value !== 'undefined';
    },
    selfClass() {
      return prefixClass;
    },
    supClass() {
      const { hasValue, type } = this;

      return {
        [`${prefixClass}__sup`]: true,
        [`${prefixClass}__sup--${type}`]: !hasValue,
        [`${prefixClass}__sup--num`]: hasValue,
        [`${prefixClass}__sup--fixed`]: this.$slots.default
      };
    },
    sup() {
      const { type, value, max, hasValue } = this;

      if (['dot', 'pulse'].includes(type) && !hasValue) {
        return '';
      }

      if (['new', 'hot', 'beta'].includes(type)) {
        return ['New', 'Hot', 'Beta'].find(item => item.toLowerCase() === type);
      }

      if (typeof value === 'number' && typeof max === 'number') {
        return max < value ? `${max}+` : value;
      }

      return value;
    },
    supStyle() {
      const { sup, max } = this;
      if (sup === `${max}+`) {
        return { 'right': '16px', 'width': '31px' };
      }
      if (sup !== '' && (typeof sup === 'number' || isFinite(sup))) {
        const len = String(sup).length;
        if (len === 2) {
          return { 'right': '12px', 'width': '24px' };
        }
        return { 'width': '20px' };
      }
    }
  }
};
</script>

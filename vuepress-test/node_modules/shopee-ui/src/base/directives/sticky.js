import Sticky from '../core/sticky';

const ctx = 'shopee-ui-sticky';

export default {
  inserted(el, binding) {
    if (binding.value) {
      const option = binding.value;
      const runHandler = option.lazy ? f => setTimeout(f) : f => f();
      runHandler(() => {
        el[ctx] = {
          stickyInstance: new Sticky(el, option)
        };
      });
    }
  },
  componentUpdated(el, binding) {
    const stickyProps = binding.value;
    const stickyInstance = el[ctx] && el[ctx].stickyInstance;
    if (stickyInstance) {
      const option = stickyInstance.option;
      const runHandler = option.lazy ? f => setTimeout(f) : f => f();
      runHandler(() => {
        stickyInstance && stickyInstance.update(stickyProps);
      });
    }
  },
  unbind(el) {
    const stickyInstance = el[ctx] && el[ctx].stickyInstance;
    if (stickyInstance) {
      stickyInstance.cleanup();
    }
  }
};
